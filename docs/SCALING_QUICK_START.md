# Быстрый старт: Масштабирование до 100+ участников

## Проблема
Текущая mesh-топология не масштабируется:
- При 100 участниках: 99 соединений на клиент
- CPU: ~99%, Память: ~500MB, Сеть: 5+ Mbps входящих

## Решение
Переход на **SFU (Selective Forwarding Unit)** архитектуру:
- 1 соединение на клиент к SFU серверу
- CPU: ~5-10%, Память: ~100MB, Сеть: ~1 Mbps

## Выбранное решение: Mediasoup

### Почему Mediasoup?
- ✅ Высокая производительность (C++ core)
- ✅ Масштабируемость до тысяч участников
- ✅ Гибкая архитектура
- ✅ Хорошая документация

## План реализации (9-13 недель)

### Фаза 1: Подготовка (1-2 недели)
- Изучение Mediasoup
- Проектирование архитектуры
- Планирование миграции

### Фаза 2: SFU сервер (2-3 недели)
- Настройка Mediasoup сервера
- Интеграция с бэкендом
- Мониторинг и метрики

### Фаза 3: Клиент (2-3 недели)
- Рефакторинг VoiceClient
- SFUVoiceClient реализация
- Оптимизация воспроизведения

### Фаза 4: Оптимизации (1-2 недели)
- Селективная пересылка
- Адаптивное качество
- Оптимизация signaling

### Фаза 5: Тестирование (2 недели)
- Нагрузочное тестирование
- Оптимизация производительности
- Тестирование совместимости

### Фаза 6: Развертывание (1 неделя)
- Постепенный rollout
- Мониторинг
- Документация

## Архитектура

```
┌─────────┐         ┌─────────┐
│ Client 1│◄───────►│   SFU   │◄───────►│ Client 2│
│         │ WebRTC  │ Server  │ WebRTC  │         │
└─────────┘         └────┬────┘         └─────────┘
                         │
                         │ Signaling
                         ▼
                  ┌──────────────┐
                  │ FastAPI      │
                  │ (Current)    │
                  └──────────────┘
```

## Ключевые изменения

### Сервер
- Новый Node.js сервис с Mediasoup
- REST API для управления комнатами
- Интеграция с текущим signaling

### Клиент
- SFUVoiceClient вместо mesh соединений
- Селективное воспроизведение (топ-N спикеров)
- Оптимизация ресурсов

## Метрики успеха

- ✅ Поддержка 100+ участников
- ✅ CPU клиента < 10%
- ✅ Память клиента < 100MB
- ✅ Задержка < 200ms
- ✅ Стабильность > 99.9%

## Следующие шаги

1. Изучить [Mediasoup документацию](https://mediasoup.org/documentation/)
2. Создать прототип SFU сервера
3. Интегрировать с текущим бэкендом
4. Обновить клиент

Подробный план: `SCALING_TO_100_PLUS_PARTICIPANTS.md`

