<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>Charge Playground · Рабочая область</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="./assets/styles/base.css" />
    <link rel="stylesheet" href="./assets/styles/workspace.css" />
  </head>
  <body class="theme-night workspace-body">
    <div class="workspace-aurora workspace-aurora--left" aria-hidden="true"></div>
    <div class="workspace-aurora workspace-aurora--right" aria-hidden="true"></div>

    <main class="workspace-shell">
      <aside class="workspace-sidebar">
        <section class="glass-card status-card" aria-labelledby="workspace-status">
          <div class="card-title-row">
            <div>
              <h2 id="workspace-status">Состояние подключения</h2>
              <p class="text-muted">
                Мы сохраняем настройки API и авторизацию, чтобы вы могли мгновенно вернуться к управлению комнатами.
              </p>
            </div>
          </div>
          <div class="status-stack">
            <span class="status-pill" id="workspace-api-status">API: —</span>
            <span class="status-pill" id="workspace-auth-status">Авторизация: неизвестно</span>
          </div>
          <div class="sidebar-actions">
            <button type="button" class="secondary" onclick="window.location.href='./index.html'">Вернуться к авторизации</button>
            <button type="button" class="ghost" id="logout-button">Выйти из аккаунта</button>
          </div>
        </section>

        <section class="glass-card journey-card" aria-labelledby="journey-heading">
          <h2 id="journey-heading">Поток работы</h2>
          <ol class="progress-steps">
            <li class="progress-step">
              <span class="step-index">01</span>
              <div>
                <h3>Авторизация</h3>
                <p>Используйте страницу входа, чтобы получить токен и активировать рабочее пространство.</p>
              </div>
            </li>
            <li class="progress-step">
              <span class="step-index">02</span>
              <div>
                <h3>Комната</h3>
                <p>Введите slug комнаты или создайте новую. Мы запомним последний выбор и покажем краткое резюме.</p>
              </div>
            </li>
            <li class="progress-step">
              <span class="step-index">03</span>
              <div>
                <h3>Каналы</h3>
                <p>Переключайтесь между текстовыми и голосовыми каналами, тестируя REST, WebSocket и WebRTC.</p>
              </div>
            </li>
          </ol>
        </section>
      </aside>

      <div class="workspace-main-grid">
        <section class="glass-card room-card" aria-labelledby="rooms-heading">
          <div class="card-title-row">
            <div>
              <h2 id="rooms-heading">Комната</h2>
              <p class="text-muted">
                Найдите существующую комнату по <code>slug</code> или создайте новую. Владелец получает права на управление каналами.
              </p>
            </div>
            <div class="status-pill" id="room-summary" hidden></div>
          </div>
          <form id="room-form" class="room-search" novalidate>
            <label class="field">
              Slug комнаты
              <input name="slug" id="room-slug" placeholder="например, general" required />
            </label>
            <div class="room-search-actions">
              <button type="submit" class="primary">Загрузить комнату</button>
              <button type="button" class="ghost" id="clear-room">Сбросить</button>
            </div>
          </form>

          <div class="room-create" id="room-create" hidden>
            <div class="room-create-header">
              <h3>Новая комната</h3>
              <p class="text-muted">
                Придумайте название — slug сформируется автоматически. После создания комната загрузится сразу.
              </p>
            </div>
            <form id="room-create-form" class="room-create-form" novalidate>
              <label class="field">
                Название комнаты
                <input name="title" id="room-title" placeholder="Например, Команда продаж" required />
              </label>
              <button type="submit" class="secondary" id="room-create-submit">Создать комнату</button>
            </form>
            <p class="status-pill" id="room-create-status" hidden></p>
          </div>

          <div id="channel-manage" class="channel-manage" hidden>
            <div class="channel-manage-header">
              <h3>Создание каналов</h3>
              <p class="text-muted">Доступно владельцам и администраторам комнаты.</p>
            </div>
            <form id="channel-create-form" class="channel-create-form" novalidate>
              <label class="field">
                Название канала
                <input name="name" id="channel-name" placeholder="Например, Общий" required />
              </label>
              <label class="field">
                Категория
                <select id="channel-category-select">
                  <option value="">Без категории</option>
                </select>
              </label>
              <div class="channel-create-actions">
                <button type="submit" class="primary" id="channel-create-text" data-channel-type="text">Текстовый</button>
                <button type="submit" class="ghost" id="channel-create-voice" data-channel-type="voice">Голосовой</button>
              </div>
            </form>
            <p class="status-pill" id="channel-create-status" hidden></p>
          </div>

          <div id="category-manage" class="category-manage" hidden>
            <div class="category-manage-header">
              <h3>Категории каналов</h3>
              <p class="text-muted">Группируйте каналы и управляйте их порядком.</p>
            </div>
            <form id="category-create-form" class="category-create-form" novalidate>
              <label class="field">
                Название категории
                <input id="category-name" placeholder="Например, Проекты" required />
              </label>
              <label class="field">
                Позиция
                <input id="category-position" type="number" min="0" value="0" />
              </label>
              <button type="submit" class="ghost">Добавить категорию</button>
            </form>
            <p class="status-pill" id="category-manage-status" hidden></p>
            <ul class="category-list" id="category-list"></ul>
          </div>

          <div id="invitation-manage" class="invitation-manage" hidden>
            <div class="invitation-manage-header">
              <h3>Приглашения</h3>
              <p class="text-muted">Создавайте ссылки для быстрого доступа в комнату.</p>
            </div>
            <form id="invitation-create-form" class="invitation-create-form" novalidate>
              <label class="field">
                Роль по приглашению
                <select id="invitation-role">
                  <option value="member">Участник</option>
                  <option value="guest">Гость</option>
                  <option value="admin">Администратор</option>
                </select>
              </label>
              <label class="field">
                Истекает
                <input id="invitation-expires" type="datetime-local" />
              </label>
              <button type="submit" class="ghost">Создать приглашение</button>
            </form>
            <p class="status-pill" id="invitation-status" hidden></p>
            <ul class="invitation-list" id="invitation-list"></ul>
          </div>

          <div id="role-manage" class="role-manage" hidden>
            <div class="role-manage-header">
              <h3>Управление ролями</h3>
              <p class="text-muted">Назначайте роли участникам и настраивайте иерархию.</p>
            </div>
            <form id="member-role-form" class="member-role-form" novalidate>
              <label class="field">
                ID участника
                <input id="member-role-user" type="number" min="1" placeholder="Например, 12" required />
              </label>
              <label class="field">
                Роль
                <select id="member-role-select"></select>
              </label>
              <button type="submit" class="ghost">Обновить роль</button>
            </form>
            <p class="status-pill" id="member-role-status" hidden></p>

            <form id="role-level-form" class="role-level-form" novalidate hidden>
              <label class="field">
                Роль
                <select id="role-level-select"></select>
              </label>
              <label class="field">
                Уровень
                <input id="role-level-value" type="number" min="0" value="0" />
              </label>
              <button type="submit" class="ghost">Сохранить уровень</button>
            </form>
            <p class="status-pill" id="role-level-status" hidden></p>

            <ul class="role-hierarchy-list" id="role-hierarchy-list"></ul>
          </div>

          <div id="channels-wrapper" class="channels-wrapper" hidden>
            <h3>Каналы комнаты</h3>
            <div class="channels-list" id="channels-list"></div>
          </div>
        </section>

        <section class="glass-card channel-panel" aria-labelledby="channel-heading" id="channel-section" hidden>
          <div class="channel-toolbar">
            <div>
              <h2 id="channel-heading">Канал не выбран</h2>
              <p class="text-muted" id="channel-hint"></p>
            </div>
            <div class="pill" id="channel-type-pill">—</div>
          </div>

          <div id="channel-admin" class="channel-admin" hidden>
            <h3>Управление каналом</h3>
            <div class="channel-admin-grid">
              <label class="field">
                Категория
                <select id="channel-category-assign">
                  <option value="">Без категории</option>
                </select>
              </label>
              <button type="button" class="secondary" id="channel-category-save">Сохранить</button>
            </div>
            <p class="status-pill" id="channel-category-status" hidden></p>
          </div>

          <div id="text-chat" class="text-chat" hidden>
            <div class="status-pill" id="chat-status">Нет активного соединения</div>
            <div class="chat-presence-bar">
              <div class="chat-presence" id="chat-presence" hidden>
                <span class="chat-presence__bullet" aria-hidden="true">●</span>
                <span class="chat-presence__text" id="chat-presence-text"></span>
              </div>
              <div class="chat-typing" id="chat-typing" hidden>
                <span class="chat-typing__text" id="chat-typing-text"></span>
              </div>
            </div>
            <div class="chat-toolbar">
              <button type="button" class="ghost" id="chat-search-toggle">Поиск</button>
            </div>
            <section class="chat-search" id="chat-search-panel" hidden>
              <form id="chat-search-form" class="chat-search__form" novalidate>
                <div class="chat-search__controls">
                  <label class="field">
                    Текст
                    <input id="chat-search-query" placeholder="Например, привет" />
                  </label>
                  <label class="field">
                    Автор
                    <input id="chat-search-author" type="number" min="1" placeholder="#" />
                  </label>
                  <label class="field">
                    Вложения
                    <select id="chat-search-has-attachments">
                      <option value="">Все сообщения</option>
                      <option value="yes">Только с вложениями</option>
                      <option value="no">Без вложений</option>
                    </select>
                  </label>
                  <label class="field">
                    С даты
                    <input id="chat-search-start" type="datetime-local" />
                  </label>
                  <label class="field">
                    По дату
                    <input id="chat-search-end" type="datetime-local" />
                  </label>
                </div>
                <div class="chat-search__actions">
                  <button type="submit" class="secondary">Искать</button>
                  <button type="button" class="ghost" id="chat-search-close">Закрыть</button>
                </div>
              </form>
              <div class="chat-search__results" id="chat-search-results"></div>
            </section>
            <div class="chat-layout">
              <div class="chat-history-wrapper">
                <div class="chat-history" id="chat-history"></div>
              </div>
              <aside class="chat-thread" id="chat-thread" hidden>
                <div class="chat-thread__header">
                  <h4 id="chat-thread-title">Тред</h4>
                  <button type="button" class="ghost" id="chat-thread-close">Закрыть</button>
                </div>
                <div class="chat-thread__body" id="chat-thread-messages"></div>
              </aside>
            </div>
            <form id="chat-form" class="chat-form" novalidate>
              <div class="chat-reply-preview" id="chat-reply-preview" hidden>
                <span class="chat-reply-preview__target" id="chat-reply-target"></span>
                <span class="chat-reply-preview__text" id="chat-reply-preview-text"></span>
                <button type="button" class="ghost" id="chat-reply-clear">Отмена</button>
              </div>
              <label class="field">
                Сообщение
                <textarea id="chat-input" placeholder="Введите сообщение" disabled></textarea>
              </label>
              <label class="field">
                Вложения
                <input id="chat-attachment-input" type="file" multiple disabled />
              </label>
              <ul class="chat-attachments chat-attachments--empty" id="chat-attachment-list"></ul>
              <div class="chat-actions">
                <button type="submit" class="primary" id="chat-send" disabled>Отправить</button>
                <button type="button" class="ghost" id="chat-disconnect" disabled>Отключиться</button>
              </div>
            </form>
          </div>

          <div id="voice-chat" class="voice-chat" hidden>
            <div class="voice-header">
              <div class="voice-header__status">
                <div class="status-pill" id="voice-status">Отключено</div>
                <div class="voice-header__stats" id="voice-stats" hidden>
                  <span class="voice-stats__item">
                    <span class="voice-stats__label">Участники</span>
                    <span class="voice-stats__value" id="voice-total-count">0</span>
                  </span>
                  <span class="voice-stats__item">
                    <span class="voice-stats__label">Спикеры</span>
                    <span class="voice-stats__value" id="voice-speaker-count">0</span>
                  </span>
                  <span class="voice-stats__item">
                    <span class="voice-stats__label">Слушатели</span>
                    <span class="voice-stats__value" id="voice-listener-count">0</span>
                  </span>
                  <span class="voice-stats__item">
                    <span class="voice-stats__label">Активные</span>
                    <span class="voice-stats__value" id="voice-active-count">0</span>
                  </span>
                </div>
              </div>
              <div class="voice-header__actions">
                <button type="button" class="ghost" id="voice-role-toggle" disabled>
                  Стать спикером
                </button>
                <button type="button" class="ghost" id="voice-mute-toggle" disabled>
                  Выключить микрофон
                </button>
                <button type="button" class="ghost" id="voice-deafen-toggle" disabled>
                  Выключить звук
                </button>
                <button type="button" class="ghost" id="voice-video-toggle" disabled>
                  Видео выкл.
                </button>
                <button type="button" class="ghost" id="voice-recording-toggle" hidden>
                  Начать запись
                </button>
              </div>
            </div>
            <div class="voice-body">
              <div class="voice-participant-grid" id="voice-participants-grid">
                <div class="voice-empty" id="voice-empty">Подключитесь, чтобы увидеть участников.</div>
              </div>
              <aside class="voice-control-panel">
                <div class="voice-device-select">
                  <label class="field">
                    Микрофон
                    <select id="microphone-select"></select>
                  </label>
                  <label class="field">
                    Камера
                    <select id="camera-select"></select>
                  </label>
                </div>
                <div class="voice-buttons">
                  <button type="button" class="primary" id="voice-connect">Подключиться</button>
                  <button type="button" class="ghost" id="voice-disconnect" disabled>Отключиться</button>
                  <button type="button" class="secondary" id="voice-start" disabled>Начать звонок</button>
                </div>
                <div class="voice-quality" id="voice-quality-panel" hidden>
                  <h4>Качество связи</h4>
                  <ul class="voice-quality-list" id="voice-quality-list"></ul>
                </div>
                <audio id="remote-audio" controls autoplay></audio>
              </aside>
            </div>
            <div class="voice-video-wall" id="voice-video-wall"></div>
          </div>
        </section>

        <div class="empty-placeholder" id="workspace-placeholder" hidden>
          Выберите или создайте комнату, а затем канал, чтобы начать текстовое или голосовое общение.
        </div>
      </div>
    </main>

    <script type="module" src="./assets/scripts/pages/workspace.js"></script>
  </body>
</html>
